<div id="page-edit-wrapper">
  <div class="reset-padding">
    <div class="col-sm-3 side-menu reset-padding">
      <%= render 'shared/side_bar' %>
    </div>
    <div class="col-sm-9 content-wrapper reset-padding">
      <div class="content">
        <h3 class="page-header">
          Edit Page
        </h3>

        <div class="snippet-preview">
          <div class="text-header"> Snippet preview</div>
          <div class="title snippet-preview-title"> <%= @page.meta_title %> </div>
          <div class="page-link"> www.domain.com<%= @page.url %></div>
          <p class="meta-desc">
            <%= @page.meta_description %>
          </p>
          <%= link_to 'javascript:void(0);', class: 'btn btn-default edit-snippet' do %>
              <i class="fa fa-pencil"></i> Edit snippet
          <% end %>
        </div>
        <div class="page-edit-form">
          <%= form_for @page, url: page_path(@page) do |f| %>
              <div class="form-group clearfix">
                <%= f.label :meta_title, 'Page Title' %>
                <%= f.text_field :meta_title, class: 'form-control page-title', data: {max_size: 70, bind: '.snippet-preview-title'} %>
                <div class="progress-wrapper clearfix">
                  <div class="used" style="width: 75%;"></div>
                  <div class="remaining" style="width: 25%;"></div>
                </div>
              </div>

              <div class="form-group clearfix">
                <%= label_tag :meta_description, 'Meta Description' %>
                <%= f.text_area :meta_description, class: 'form-control', data: {max_size: 156, bind: '.meta-desc'} %>
                <div class="progress-wrapper clearfix">
                  <div class="used" style="width: 95%;"></div>
                  <div class="remaining" style="width: 5%;"></div>
                </div>
              </div>

              <div class="form-group">
                <button class='btn btn-success'>
                  <i class="fa fa-save"></i> Save
                </button>
              </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    $(function () {
        updateProgress($('#seo_page_meta_title'));
        updateProgress($('#seo_page_meta_description'));
        $('.edit-snippet').click(function () {
            $('.page-edit-form').show();
        });

        $('#seo_page_meta_title, #seo_page_meta_description').keyup(function () {
            updateProgress($(this));
        });

        function updateProgress(element, value) {
            var maxSize = element.attr('data-max-size');
            var bind = element.attr('data-bind');
            var used = 0, remaining = 100;
            var length = getterSetter(element, maxSize, bind);
            if (length > 0) {
                used = (length / maxSize) * 100;
                remaining = 100 - used;
            }
            progressBar = element.next();
            progressBar.find('.remaining').show().css('width', remaining + '%');
            progressBar.find('.used').show().css('width', used + '%');
            if (used >= 100) {
                progressBar.find('.remaining').hide();
            }
            else if (used == 0) {
                progressBar.find('.used').hide();
            }
        }

        function getterSetter(element, maxSize, bind) {
            var value;
            value = element.val();
            if (value.length >= maxSize) {
                value = value.substring(0, maxSize);
                element.val(value);
                return maxSize;
            }
            if (value != '') {
                $(bind).html(value);
            }
            return value.length;
        }
    });
</script>
